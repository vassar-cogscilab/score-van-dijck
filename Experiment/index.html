<!DOCTYPE html>
<html>
  <head>
    <script src="jspsych-6.1.0/jspsych.js"></script>
    <script src="jspsych-6.1.0/plugins/jspsych-html-keyboard-response.js"></script>
    <script src="jspsych-6.1.0/plugins/jspsych-survey-text.js"></script>
    <script src="custom-plugins/jspsych-corsi.js"></script>
    <link rel="stylesheet" type="text/css" href="jspsych-6.1.0/css/jspsych.css">
  </head>
  <body>
  </body>
  <script>

  var timeline = [];

  var baseline_task_odd_left = {
    timeline: [
      {
        type: 'html-keyboard-response',
        stimulus: '<p>+</p>',
        trial_duration: 500,
        choices: jsPsych.NO_KEYS
      },
      {
        type: 'html-keyboard-response',
        stimulus: jsPsych.timelineVariable('digit'),
        choices: ['a', 'l'],
        data: {
          correct_response: jsPsych.timelineVariable('target_response'),
          parity: jsPsych.timelineVariable('parity')
        },
        on_finish: function(data){
          data.correct = data.correct_response == jsPsych.pluginAPI.convertKeyCodeToKeyCharacter(data.key_press);
        }
      },
      {
        type: 'html-keyboard-response',
        stimulus: function(){
          if(jsPsych.data.get().last(1).values()[0].correct){
            return '<p>+</p>';
          } else {
            return '<p style="color: red;">+</p>';
          }
        },
        trial_duration: 250,
        choices: jsPsych.NO_KEYS,
        post_trial_gap: 250
      }
    ],
    timeline_variables: [
      {digit: 1, parity: 'odd', target_response: 'a'},
      {digit: 2, parity: 'even', target_response: 'l'},
      {digit: 3, parity: 'odd', target_response: 'a'},
      {digit: 4, parity: 'even', target_response: 'l'},
      {digit: 6, parity: 'even', target_response: 'l'},
      {digit: 7, parity: 'odd', target_response: 'a'},
      {digit: 8, parity: 'even', target_response: 'l'},
      {digit: 9, parity: 'odd', target_response: 'a'},
    ],
    randomize_order: true,
    repetitions: 16
  }

  var seq_loc = 0;
  var wm_span_verbal = {
    timeline: [
      {
        type: 'html-keyboard-response',
        stimulus: '',
        choices: jsPsych.NO_KEYS,
        trial_duration: 1500,
      },
      {
        timeline: [
          {
            type: 'html-keyboard-response',
            stimulus: function(){
              return jsPsych.timelineVariable('sequence',true)[seq_loc]
            },
            choices: jsPsych.NO_KEYS,
            trial_duration: 1250,
            post_trial_gap: 250
          }
        ],
        loop_function: function(){
          seq_loc++;
          if(seq_loc == jsPsych.timelineVariable('sequence', true).length){
            return false;
          } else {
            return true;
          }
        }
      },
      {
        type: 'html-keyboard-response',
        stimulus: '',
        choices: jsPsych.NO_KEYS,
        trial_duration: 1250,
        on_finish: function(){
          seq_loc = 0;
        }
      },
      {
        type: 'survey-text',
        questions: [{prompt: 'Type the sequence of letters in the same order you saw them'}],
        data: {
          phase: 'wm-span',
          length: jsPsych.timelineVariable('sequence_length')
        },
        on_finish: function(data){
          var response = JSON.parse(data.responses).Q0;
          var normed_response = response.trim().toLowerCase();
          var arrayed_response = normed_response.split('').filter(function(x){ return(x != " ") });
          var correct = JSON.stringify(arrayed_response) == JSON.stringify(jsPsych.timelineVariable('sequence', true));
          data.correct = correct;
        }
      }
    ],
    timeline_variables: [
      {sequence: ['t','v','k']},
      {sequence: ['g','r','q']}
    ]
  }

  var wm_span_spatial = {

  }

  var corsi_test = {
    type: 'corsi',
    blocks: [
      {y: 20, x: 20},
      {y: 50, x: 50},
      {y: 80, x: 80}
    ],
    mode: 'display',
    block_size: 50,
    arena_width: 750,
    arena_height: 500,
    sequence: [0,1,2,1,2,1,2,1,0],
    sequence_duration: 250,
    pre_stim_duration: 500
  }
  timeline.push(corsi_test);

  jsPsych.init({
    timeline: timeline
  })


  </script>
</html>